---
title: "lending_Club"
author: "Huiting Sheng, Hua Zou, Lixin Wang"
date: "9/9/2020"
output: html_document
---

## Import Data
```{r import data}
data=read.csv("LoanStats3a.csv", heade=T)
head(data)
```

## Load in packages
```{r loadingPackages}
if(!require(tidyverse)){install.packages('tidyverse');require(tidyverse)}

if(!require(corrplot)){install.packages('corrplot');require(corrplot)}

if(!require(caret)){install.packages('caret');require(caret)}

if(!require(e1071)){install.packages('e1071');require(e1071)}

if(!require(reshape2)){install.packages('reshape2');require(reshape2)}
```

## Data cleaning and pre-processing

#### Select features of interest
```{r}
# check NAs in the dataset
str(data)

NAcol <- which(colSums(is.na(data))>0)
library(knitr) 
kable(sort(colSums(sapply(data[NAcol], is.na)),decreasing = T) )


# remove all empty columns
data = Filter(function(x)!all(is.na(x)), data)


# find the column with single value except for NA. 
data1 = data %>%
  drop_na() %>%
  select_if(~n_distinct(.) < 2)

sapply(data1, function(x){length((unique(x)))})


# remove some unimportant columns and columns with 1 levels besides NA.
sapply(data,function(x){ length(unique(x)) })

loanData = data %>%
  select(-id, -member_id, -issue_d, -url, -desc, -earliest_cr_line, -pub_rec_bankruptcies, -last_pymnt_d, -next_pymnt_d, -last_credit_pull_d, -application_type, -mths_since_last_delinq, -mths_since_last_record, -colnames(data1))

str(loanData)

# Check class of the loanData
table(sapply(loanData[1,],class))

sapply(loanData, function(x){ length(unique(x)) })
# ??? it looks like we have some numeric qualitative features.

``` 

#### Missing values
```{r missingvalues}
# check how many NAs in each feature of quantative features
sapply(loanData, FUN = function(x) sum(is.na(x)))

# check the rows with NAs
naData = loanData %>% filter_all(any_vars(is.na(.)))

# impute missing values with "preProcess"
require(RANN)

loandataImputeMedian = preProcess(loanData, method = 'medianImpute', k = 5)
loandataImpute = predict(loandataImputeMedian, loanData)
anyNA(loandataImpute)

# Check for numeric features, impute missing values
loandataImputeMedian = preProcess(loanDataQuant, method = 'medianImpute', k = 5)
loandataImpute = predict(loandataImputeMedian, loanDataQuant)
anyNA(loandataImpute)

# Correlation plot omit the missing data
dataNumCorr = cor(loandataImpute)
corrplot(dataNumCorr, order = "hclust", tl.cex = 0.35)

# remove the correlated features
highcorr = findCorrelation(dataNumCorr, 0.85, verbose=TRUE, names = TRUE)
segloandataImputeRemoveCorr = select(loandataImpute, -highcorr)
colnames(segloandataImputeRemoveCorr)

```

#### Skewness check
```{r}
skewed = apply(loanDataQuant,2,skewness)
skewed

skewed = apply(loandataImpute,2,skewness)
skewed
```